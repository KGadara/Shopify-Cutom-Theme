{% comment %}
  Section: Animated Brand Pillars
  - A customizable section to showcase key brand features with scroll-triggered animations.
  - Uses Intersection Observer for performance.
  - Fully configurable through the Shopify Theme Customizer.
{% endcomment %}

<style>
  .animated-pillars-section {
    padding: 60px 20px;
    background-color: {{ section.settings.background_color }};
    color: {{ section.settings.text_color }};
    text-align: center;
  }

  .animated-pillars-section__header {
    margin-bottom: 50px;
  }

  .animated-pillars-section__header h2 {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0;
    color: {{ section.settings.heading_color }};
  }

  .animated-pillars-section__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Tablet and Desktop Layout */
  @media (min-width: 750px) {
    .animated-pillars-section__grid {
      grid-template-columns: repeat({{ section.blocks.size }}, 1fr);
    }
  }

  .animated-pillars-section__pillar {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* The animation class added by JavaScript */
  .animated-pillars-section__pillar--visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Stagger the animation for each pillar */
  {% for block in section.blocks %}
    .animated-pillars-section__pillar--visible:nth-child({{ forloop.index }}) {
      transition-delay: {{ forloop.index | times: 150 }}ms;
    }
  {% endfor %}

  .animated-pillars-section__icon-wrapper {
    margin-bottom: 20px;
    color: {{ section.settings.icon_color }};
  }

  .animated-pillars-section__icon-wrapper svg {
    width: 60px;
    height: 60px;
  }

  .animated-pillars-section__pillar-heading {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 10px 0;
    color: {{ section.settings.heading_color }};
  }

  .animated-pillars-section__pillar-text {
    font-size: 1rem;
    line-height: 1.6;
    margin: 0;
  }
</style>

<div class="animated-pillars-section" data-section-id="{{ section.id }}">
  <div class="animated-pillars-section__header">
    {% if section.settings.heading != blank %}
      <h2>{{ section.settings.heading | escape }}</h2>
    {% endif %}
  </div>

  {% if section.blocks.size > 0 %}
    <div class="animated-pillars-section__grid">
      {% for block in section.blocks %}
        <div class="animated-pillars-section__pillar" {{ block.shopify_attributes }}>
          <div class="animated-pillars-section__icon-wrapper">
            {% if block.settings.icon_svg != blank %}
              {{ block.settings.icon_svg }}
            {% else %}
              {% comment %} Placeholder Icon {% endcomment %}
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.685-2.685L11.25 18l1.938-.648a3.375 3.375 0 002.685-2.685L16.25 13.5l.648 1.938a3.375 3.375 0 002.685 2.685L21.75 18l-1.938.648a3.375 3.375 0 00-2.685 2.685z" />
              </svg>
            {% endif %}
          </div>
          {% if block.settings.heading != blank %}
            <h3 class="animated-pillars-section__pillar-heading">{{ block.settings.heading | escape }}</h3>
          {% endif %}
          {% if block.settings.text != blank %}
            <p class="animated-pillars-section__pillar-text">{{ block.settings.text | escape }}</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sectionObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const pillars = entry.target.querySelectorAll('.animated-pillars-section__pillar');
          pillars.forEach(pillar => {
            pillar.classList.add('animated-pillars-section__pillar--visible');
          });
          // Optional: unobserve after animation to save resources
          observer.unobserve(entry.target);
        }
      });
    }, {
      rootMargin: '0px 0px -100px 0px' // Trigger when the section is 100px into the viewport
    });

    const targetSection = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (targetSection) {
      sectionObserver.observe(targetSection);
    }
  });

  // Handle Shopify Theme Editor events for real-time updates
  document.addEventListener('shopify:section:load', function(event) {
    const targetSection = event.target.querySelector('[data-section-id="{{ section.id }}"]');
    if (targetSection) {
      const pillars = targetSection.querySelectorAll('.animated-pillars-section__pillar');
      pillars.forEach(pillar => {
        pillar.classList.remove('animated-pillars-section__pillar--visible');
      });
      
      const sectionObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const visiblePillars = entry.target.querySelectorAll('.animated-pillars-section__pillar');
            visiblePillars.forEach(p => p.classList.add('animated-pillars-section__pillar--visible'));
            observer.unobserve(entry.target);
          }
        });
      }, { rootMargin: '0px 0px -100px 0px' });
      
      sectionObserver.observe(targetSection);
    }
  });
</script>

{% schema %}
{
  "name": "Animated Brand Pillars",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Our Promise to You"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#121212"
    }
  ],
  "blocks": [
    {
      "type": "pillar",
      "name": "Brand Pillar",
      "limit": 4,
      "settings": [
        {
          "type": "html",
          "id": "icon_svg",
          "label": "Icon SVG Code",
          "info": "Find free icons at heroicons.com or similar sites. Copy the entire SVG code and paste it here."
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Pillar Heading",
          "default": "Feature Title"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Pillar Text",
          "default": "Explain this feature or promise in a short, compelling sentence."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Animated Brand Pillars",
      "blocks": [
        {
          "type": "pillar",
          "settings": {
            "icon_svg": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V14.25m-17.25 4.5v-1.875a3.375 3.375 0 003.375-3.375h1.5a1.125 1.125 0 011.125 1.125v-1.5a3.375 3.375 0 00-3.375-3.375H3.375m15.75 9V18.75m0-5.25v-1.5a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 003.375-3.375H20.625a1.125 1.125 0 011.125 1.125v18M12 4.5v.01m0 3v.01m0 3v.01m0 3v.01m0 3v.01m0 3v.01\" /></svg>",
            "heading": "Free Worldwide Shipping",
            "text": "We ship to over 200 countries at no extra cost on all orders over $50."
          }
        },
        {
          "type": "pillar",
          "settings": {
            "icon_svg": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-2.696a4.5 4.5 0 016.364 0l-1.06 1.06a2.25 2.25 0 00-3.182 0l-1.06-1.06a4.5 4.5 0 010-6.364l1.06-1.06a2.25 2.25 0 000-3.182l-1.06-1.06a4.5 4.5 0 01-6.364 0l-1.06 1.06a2.25 2.25 0 00-3.182 0l-1.06 1.06a4.5 4.5 0 010 6.364l1.06 1.06a2.25 2.25 0 003.182 0l1.06-1.06z\" /></svg>",
            "heading": "Sustainable Materials",
            "text": "Our products are crafted from ethically sourced and recycled materials."
          }
        },
        {
          "type": "pillar",
          "settings": {
            "icon_svg": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z\" /></svg>",
            "heading": "Handmade with Love",
            "text": "Every item is uniquely handcrafted by our team of passionate artisans."
          }
        }
      ]
    }
  ]
}
{% endschema %}
